#  正则表达式概念

简介表大一组字符串的表达式

正则表达式主要用于字符串匹配

正则表达式：编译：将符合正则表达式语法的字符串转化成正则表达式特征。

| 操作符 | 说明                             | 实例                                    |
| ------ | -------------------------------- | --------------------------------------- |
| .      | 表示任何单个字符                 |                                         |
| []     | 字符集，对单个字符给出取值范围   | [abc]表示a、b、c，[a_z]表示a到z单个字符 |
| [^ ]   | 非字符集，对单个字符给出排除范围 | [^abc]表示非a、b、c的单个字符           |
| *      | 前一个字符0次或无限次扩展        | abc*表示ab、abc、abcc、abccc等          |
| +      | 前一个字符1次或无限次扩展        | abc+表示abc、abcc、abccc等              |
| ？     | 前一个字符0次或一次扩展          | abc？表示ab、abc                        |
| \|     | 左右表达式任意一个               | abc\|def表示abc、def                    |

加问好变成最小匹配操作符 

| 操作符 | 说明                           | 实例                                     |
| ------ | ------------------------------ | ---------------------------------------- |
| {m}    | 扩展前一个字符m次              | ab{2}c表示abbc                           |
| {m,n}  | 扩展前一个字符m至n次（含n）    | ab{1，2}c表示abc、abbc                   |
| ^      | 匹配字符串开头                 | ^abc表示abc且在一个字符串的开头          |
| $      | 匹配字符串结尾                 | abc$表示abc且在一个字符串的结尾          |
| ()     | 分组标记，内部只能使用\|操作符 | （abc）表示abc，（abc\|def）表示abc、def |
| \d     | 数字，等价于[0-9]              |                                          |
| \w     | 单词字符，等价于[A-Za-z0-9...] |                                          |

# RE库

原生字符串是不包含转义符的字符串

| 函数          | 说明                                                         |
| ------------- | ------------------------------------------------------------ |
| re.search()   | 在一个字符串中搜索匹配正则表达式的第一个位置，返回match对象  |
| re.match()    | 从一个字符串的开始位置起匹配正则表达式，返回match对象        |
| re.findall()  | 搜索字符串，从列表类型返回全部能匹配的子串                   |
| re.split()    | 将一个字符串按照正则表达式匹配结果进行分割，返回列表类型     |
| re.finditer() | 搜索字符串，返回一个匹配结果的迭代类型，每个迭代元素是match对象 |
| re.sub()      | 在一个字符串中替换所有匹配正则表达式的子串，返回替换后的字符串 |

re.search(pattern,string,flags = 0)

pattern:正则表达式的字符串或者原生字符串

string：待匹配字符串

flags：正则表达式使用的控制标记

re.split(pattern,string,maxsplit = 0,flags = 0)

maxsplit：最大分割数，剩余部分作为最后一个元素输出，若等于一只匹配一个，返回剩下所有

re.sub(pattern,repl,string,count = 0,flags = 0)

repl:替换匹配字符串的字符串

count：匹配的最大替换次数

| 常用标记            | 说明                                                         |
| ------------------- | ------------------------------------------------------------ |
| re.I  re.IGNORECASE | 忽略正则表达式的大小写，[A-Z]能够匹配小写字符                |
| re.M re.MULTILINE   | 正则表达式中的^操作符能够将给定字符串的每行当作匹配开始      |
| re,S re.DOTALL      | 正则表达式中的.操作符能够匹配所有字符，默认匹配除换行外的所有字符 |

面向对象的用法：编译后多次操作

pat = re.compile(r'[1-9]\d{5}')

rst = pat.search('.....')

re.compile(pattern,flags = 0)

### match

属性

| 属性    | 说明                         |
| ------- | ---------------------------- |
| .string | 待匹配的文本                 |
| .re     | 匹配时使用的pattern对象      |
| .pos    | 正则表达式搜索文本的开始位置 |
| .endpos | 正则表达式搜索文本的结束位置 |

方法

| 方法      | 说明                             |
| --------- | -------------------------------- |
| .group(0) | 获得匹配后的字符串               |
| .start()  | 匹配字符串在原始字符串的开始位置 |
| .end()    | 匹配字符串在原始字符串的结束位置 |
| .span()   | 返回(.start(),end())             |

# 淘宝商品比价定向爬虫

第一页

[https://uland.taobao.com/sem/tbsearch?refpid=mm_26632258_3504122_32538762&clk1=8688d9da0044786d42d47d43c21e6d0d&keyword=%E6%9D%AF%E5%AD%90&page=0](https://uland.taobao.com/sem/tbsearch?refpid=mm_26632258_3504122_32538762&clk1=8688d9da0044786d42d47d43c21e6d0d&keyword=杯子&page=0)

二页

[https://uland.taobao.com/sem/tbsearch?spm=a2e15.8261149.07626516003.1.523c29b4g6mwge&refpid=mm_26632258_3504122_32538762&clk1=8688d9da0044786d42d47d43c21e6d0d&keyword=%E6%9D%AF%E5%AD%90&page=2&_input_charset=utf-8]**(https://uland.taobao.com/sem/tbsearch?spm=a2e15.8261149.07626516003.1.523c29b4g6mwge&refpid=mm_26632258_3504122_32538762&clk1=8688d9da0044786d42d47d43c21e6d0d&keyword=杯子&page=2&_input_charset=utf-8)**

三页

[https://uland.taobao.com/sem/tbsearch?spm=a2e15.8261149.07626516003.3.7ba429b4GvdsDX&refpid=mm_26632258_3504122_32538762&clk1=8688d9da0044786d42d47d43c21e6d0d&keyword=%E6%9D%AF%E5%AD%90&page=3&_input_charset=utf-8]**(https://uland.taobao.com/sem/tbsearch?spm=a2e15.8261149.07626516003.3.7ba429b4GvdsDX&refpid=mm_26632258_3504122_32538762&clk1=8688d9da0044786d42d47d43c21e6d0d&keyword=杯子&page=3&_input_charset=utf-8)**

发现规律

```python
import requests
import re

def getHTMLText(url):
    try:
        kv =  {'user-agent':'Mozilla/5.0',
       'cookie':'thw=cn; hng=CN%7Czh-CN%7CCNY%7C156; enc=lFa6R6sKQQFAOCpBTy71L%2BrH0ExQeOTqfsP3XVt52%2FPTVdKxWGgk5yKBApJP2%2BhQDTFHDC4plY8c11TLErAeVw%3D%3D; cna=WjAeFoLqUzECAXxZEAD6+kFN; miid=662741321535152106; _m_h5_tk=e1604072785c159b7fcb904a7dbd323a_1587057576526; _m_h5_tk_enc=a780b4733f2c9b1112de1e6f2dc85034; t=57a5b6ecffbf04426862e54cc3cc949a;'}
        r = requests.get(url,headers = kv,timeout = 30)
        r.raise_for_status()
        r.encoding = r.apparent_encoding
        return r.text
    except:
        return""

def parsePage(hlist,html):
    try:
        plt = re.findall(r'\"view_price\"\:\"[\d\.]*\"',html)
        tlt = re.findall(r'\"raw_title\"\:\".*?"',html)
        for i in range(len(plt)):            
            price = eval(plt[i].split(':')[1])       
            title = eval(tlt[i].split(':')[1])
            hlist.append([price,title])
    except:
        print(123465)
    
def printGoodslist(hlist):
    tplt = "{:4}\t{:8}\t{:16}"
    print(tplt.format("序号","价格","商品名称"))
    count = 0
    for g in hlist:
        count = count + 1
        print(tplt.format(count,g[0],g[1]))
        
    
def main():
    goods = '水杯'
    depth = 2
    start_url = 'https://s.taobao.com/search?q='+ goods
    inforlist = []
    for i in range(depth):
        try:
            url = start_url + '&page' + str(i)
            html = getHTMLText(url)
            parsePage(inforlist,html)
        except:
            continue
    printGoodslist(inforlist)
        
main()
```

   淘宝用cookies反爬虫，根据参考，登录淘宝账户，获取相应的cookies之后写道爬虫之中。



